<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>BLKPVNTHR Admin Dashboard</title>

        <link rel="stylesheet" href="styles.css?v=4" />
        <link
            rel="stylesheet"
            href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.min.css" />
    </head>

    <body class="locked">

        <!-- LOGIN OVERLAY -->
        <div id="authOverlay" class="overlay" aria-hidden="false">
            <div class="auth-card">
                <h1 class="title">BLKPVNTHR Admin</h1>
                <p class="muted">Sign in to unlock.</p>

                <label class="label" for="email">Email</label>
                <input id="email" type="email" placeholder="you@email.com"
                    autocomplete="email" />

                <button id="sendLinkBtn" class="btn primary" type="button">
                    Send magic link
                </button>

                <div class="divider"></div>

                <label class="label" for="pin">Optional PIN (privacy
                    screen)</label>
                <input id="pin" type="password" inputmode="numeric"
                    autocomplete="off" />

                <button id="unlockBtn" class="btn ghost" type="button">
                    Unlock (PIN only)
                </button>

                <p id="authMsg" class="msg" role="status"
                    aria-live="polite"></p>

                <p class="tiny muted">
                    Use magic link for real security. PIN is client-side only.
                </p>
            </div>
        </div>
        <!DOCTYPE html>
        <html lang="en">
            <head>
                <meta charset="UTF-8" />
                <meta name="viewport"
                    content="width=device-width, initial-scale=1.0" />
                <title>BLKPVNTHR Admin Dashboard</title>

                <link rel="stylesheet" href="styles.css?v=4" />
                <link
                    rel="stylesheet"
                    href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.min.css" />
            </head>

            <body class="locked">
                <!-- LOGIN OVERLAY -->
                <div id="authOverlay" class="overlay" aria-hidden="false">
                    <div class="auth-card">
                        <h1 class="title">BLKPVNTHR Admin</h1>
                        <p class="muted">Sign in to unlock.</p>

                        <label class="label" for="email">Email</label>
                        <input id="email" type="email"
                            placeholder="you@email.com"
                            autocomplete="email" />

                        <button id="sendLinkBtn" class="btn primary"
                            type="button">
                            Send magic link
                        </button>

                        <div class="divider"></div>

                        <label class="label" for="pin">Optional PIN (privacy
                            screen)</label>
                        <input id="pin" type="password" inputmode="numeric"
                            autocomplete="off" />

                        <button id="unlockBtn" class="btn ghost" type="button">
                            Unlock (PIN only)
                        </button>

                        <p id="authMsg" class="msg" role="status"
                            aria-live="polite"></p>

                        <p class="tiny muted">
                            Use magic link for real security. PIN is client-side
                            only.
                        </p>
                    </div>
                </div>

                <!-- NAVBAR WILL LOAD HERE -->
                <div id="navbar-placeholder"></div>

                <main class="main-col">
                    <!-- APP -->
                    <div id="app" class="container hidden" aria-hidden="true">

                        <header class="header">
                            <div>
                                <h1>BLKPVNTHR Financial Dashboard</h1>
                                <p class="muted">Grantor trust owned LLC ·
                                    bookkeeping · monthly totals</p>
                            </div>

                            <div class="header-actions">
                                <button id="logoutBtn" class="btn ghost"
                                    type="button">Lock</button>
                            </div>
                        </header>

                        <!-- FULL WIDTH: Monthly Totals -->
                        <section class="card fullwidth">
                            <h2>Monthly Totals</h2>

                            <div class="actions">
                                <button id="snapshotMonthBtn"
                                    class="btn primary" type="button">
                                    Save snapshot for selected month
                                </button>

                                <select id="monthSelect"></select>
                            </div>

                            <h3 class="muted" style="margin-top: 10px">Live
                                totals (computed)</h3>
                            <table id="liveTotalsTable" class="display"
                                style="width: 100%">
                                <thead>
                                    <tr>
                                        <th>Month</th>
                                        <th># Payments</th>
                                        <th>Total Gross</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>

                            <h3 class="muted" style="margin-top: 10px">Saved
                                snapshots</h3>
                            <table id="savedTotalsTable" class="display"
                                style="width: 100%">
                                <thead>
                                    <tr>
                                        <th>Month</th>
                                        <th># Payments</th>
                                        <th>Total Gross</th>
                                        <th>Snapshot time</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </section>

                    </div>

                    <!-- PAYMENT MODAL (keep OUTSIDE auth + app) -->
                    <div id="paymentModal" class="modal hidden"
                        aria-hidden="true">
                        <div class="modal-card">
                            <div class="modal-header">
                                <h2 id="paymentModalTitle">Add Payment</h2>
                                <button id="paymentModalClose" class="btn ghost"
                                    type="button">×</button>
                            </div>

                            <div class="modal-body">
                                <div class="grid2">
                                    <div>
                                        <label class="label">Payment
                                            Date</label>
                                        <input id="m_payment_date"
                                            type="date" />
                                    </div>

                                    <div>
                                        <label class="label">Status</label>
                                        <select id="m_status">
                                            <option
                                                value="received">Received</option>
                                            <option
                                                value="pending">Pending</option>
                                            <option value="void">Void</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="label">Gross
                                            Amount</label>
                                        <input id="m_amount_gross" type="number"
                                            step="0.01"
                                            placeholder="0.00" />
                                    </div>

                                    <!-- Optional net input: keep it if your JS supports net-first/auto -->
                                    <div>
                                        <label class="label">Net Amount
                                            (Deposit)</label>
                                        <input id="m_amount_net" type="number"
                                            step="0.01"
                                            placeholder="0.00" />
                                    </div>

                                    <div>
                                        <label class="label">Pension
                                            Deduction</label>
                                        <input id="m_pension" type="number"
                                            step="0.01"
                                            placeholder="0.00" />
                                    </div>

                                    <div>
                                        <label class="label">Tax
                                            Deduction</label>
                                        <input id="m_tax_ded" type="number"
                                            step="0.01"
                                            placeholder="0.00" />
                                    </div>

                                    <div>
                                        <label class="label">SS +
                                            Medicare</label>
                                        <input id="m_ss" type="number"
                                            step="0.01"
                                            placeholder="0.00" />
                                    </div>

                                    <div>
                                        <label class="label">Memo</label>
                                        <input id="m_memo" type="text"
                                            placeholder="e.g. Pay period 3/1–3/14" />
                                    </div>

                                    <div class="checkrow">
                                        <label class="check">
                                            <input id="m_health"
                                                type="checkbox" />
                                            Health insurance payment
                                        </label>
                                    </div>

                                    <div class="checkrow">
                                        <label class="check">
                                            <input id="m_edu" type="checkbox" />
                                            Education payment
                                        </label>
                                    </div>
                                </div>

                                <div style="margin-top: 10px">
                                    <label class="label">Entry Mode</label>
                                    <select id="pay_mode">
                                        <option
                                            value="gross">Gross-first</option>
                                        <option value="net">Net-first</option>
                                        <option
                                            value="auto">Auto-detect</option>
                                    </select>
                                </div>

                                <div class="rates">
                                    <details>
                                        <summary>Override rates (this
                                            payment)</summary>
                                        <div class="grid3">
                                            <div>
                                                <label class="label">Pension
                                                    %</label>
                                                <input id="rate_pension"
                                                    type="number" step="0.01"
                                                    placeholder="36" />
                                            </div>
                                            <div>
                                                <label class="label">Tax
                                                    %</label>
                                                <input id="rate_tax"
                                                    type="number" step="0.01"
                                                    placeholder="5.43" />
                                            </div>
                                            <div>
                                                <label class="label">SS+Medicare
                                                    %</label>
                                                <input id="rate_ss"
                                                    type="number" step="0.01"
                                                    placeholder="7.65" />
                                            </div>
                                        </div>
                                    </details>
                                </div>
                            </div>

                            <div class="modal-footer actions">
                                <div id="reconcileBox"
                                    class="reconcile neutral">
                                    <strong>Reconciliation</strong>
                                    <div id="reconcileMsg">Enter values to
                                        validate…</div>
                                </div>

                                <button id="paymentModalSave"
                                    class="btn primary"
                                    type="button">Save</button>
                                <button id="paymentModalCancel"
                                    class="btn ghost"
                                    type="button">Cancel</button>
                            </div>
                        </div>
                    </div>

                    <!-- Scripts (end of body, in correct order) -->
                    <script>
                // Load navbar fragment
                fetch("navbar.html")
                  .then(r => r.text())
                  .then(html => {
                    document.getElementById("navbar-placeholder").innerHTML = html;

                    // Mobile toggle after load
                    const toggle = document.querySelector(".nav-toggle");
                    const menu = document.querySelector(".nav-menu");

                    toggle?.addEventListener("click", () => {
                      menu.classList.toggle("open");
                    });
                  });
              </script>
                    <script
                        src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
                    <script
                        src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>
                    <script
                        src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

                    <script>
      const SUPABASE_URL = "https://yckcsfddsudtwgrtfeje.supabase.co";
      const SUPABASE_KEY = "sb_publishable_MX6RRurbwmNt9E7iZ0L_4Q_YPXgH1ct";
      window.sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
      console.log("Supabase initialized:", !!window.sb);
    </script>

                    <script src="app.js"></script>
                </body>
            </html>
